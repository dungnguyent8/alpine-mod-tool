var background=(function(){"use strict";const f=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function Y(t){return t==null||typeof t=="function"?{main:t}:t}const R="active-tabs",$="settings",J="nag-screen-v1-shown-at",U="__ALPINEJS_PRO_DEVTOOLS_ATTRIBUTES__",m={BACKGROUND:"background",CONTENT:"content",DEVTOOLS:"devtools",PROXY:"proxy",INSPECTOR:"inspector"},y={LOAD_DETECTOR:"load-detector",INJECT_INSPECTOR:"inject-inspector",ADD_ERROR:"add-error",ALPINE_DETECTED:"alpine-detected",DEVTOOLS_READY:"devtools-ready",EDIT_ATTRIBUTE:"edit-attribute",HEARTBEAT:"heartbeat",HEARTBEAT_RESPONSE:"heartbeat-response",PROXY_FAIL:"proxy-fail",PROXY_READY:"proxy-ready",PROXY_SHUTDOWN:"proxy-shutdown",SET_COMPONENTS:"set-components",SET_DATA:"set-data",SET_VERSION:"set-version",SETTINGS_CHANGED:"settings-changed",SET_STORES:"set-stores",SET_STORE_DATA:"set-store-data",EDIT_STORE_VALUE:"edit-store-value",EVENT_DISPATCHED:"event-dispatched"},v=()=>{},h={log:v,warn:v,error:v,info:v,debug:v};var _,w;function F(){if(w)return _;w=1,_=g,g.default=g,g.stable=j,g.stableStringify=j;var t="[...]",e="[Circular]",o=[],l=[];function E(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function g(r,n,a,i){typeof i>"u"&&(i=E()),I(r,"",0,[],void 0,0,i);var c;try{l.length===0?c=JSON.stringify(r,n,a):c=JSON.stringify(r,x(n),a)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;o.length!==0;){var d=o.pop();d.length===4?Object.defineProperty(d[0],d[1],d[3]):d[0][d[1]]=d[2]}}return c}function T(r,n,a,i){var c=Object.getOwnPropertyDescriptor(i,a);c.get!==void 0?c.configurable?(Object.defineProperty(i,a,{value:r}),o.push([i,a,n,c])):l.push([n,a,r]):(i[a]=r,o.push([i,a,n]))}function I(r,n,a,i,c,d,u){d+=1;var s;if(typeof r=="object"&&r!==null){for(s=0;s<i.length;s++)if(i[s]===r){T(e,r,n,c);return}if(typeof u.depthLimit<"u"&&d>u.depthLimit){T(t,r,n,c);return}if(typeof u.edgesLimit<"u"&&a+1>u.edgesLimit){T(t,r,n,c);return}if(i.push(r),Array.isArray(r))for(s=0;s<r.length;s++)I(r[s],s,s,i,r,d,u);else{var S=Object.keys(r);for(s=0;s<S.length;s++){var L=S[s];I(r[L],L,s,i,r,d,u)}}i.pop()}}function W(r,n){return r<n?-1:r>n?1:0}function j(r,n,a,i){typeof i>"u"&&(i=E());var c=N(r,"",0,[],void 0,0,i)||r,d;try{l.length===0?d=JSON.stringify(c,n,a):d=JSON.stringify(c,x(n),a)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;o.length!==0;){var u=o.pop();u.length===4?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}}return d}function N(r,n,a,i,c,d,u){d+=1;var s;if(typeof r=="object"&&r!==null){for(s=0;s<i.length;s++)if(i[s]===r){T(e,r,n,c);return}try{if(typeof r.toJSON=="function")return}catch{return}if(typeof u.depthLimit<"u"&&d>u.depthLimit){T(t,r,n,c);return}if(typeof u.edgesLimit<"u"&&a+1>u.edgesLimit){T(t,r,n,c);return}if(i.push(r),Array.isArray(r))for(s=0;s<r.length;s++)N(r[s],s,s,i,r,d,u);else{var S={},L=Object.keys(r).sort(W);for(s=0;s<L.length;s++){var O=L[s];N(r[O],O,s,i,r,d,u),S[O]=r[O]}if(typeof c<"u")o.push([c,n,r]),c[n]=S;else return S}i.pop()}}function x(r){return r=typeof r<"u"?r:function(n,a){return a},function(n,a){if(l.length>0)for(var i=0;i<l.length;i++){var c=l[i];if(c[1]===n&&c[0]===a){a=c[2],l.splice(i,1);break}}return r.call(this,n,a)}}return _}F();const b={async get(t){return new Promise((e,o)=>{f.storage.local.get(t,l=>{if(f.runtime.lastError)return o(f.runtime.lastError);e(l[t])})})},async set(t,e){return new Promise((o,l)=>{f.storage.local.set({[t]:e},()=>{if(f.runtime.lastError)return l(f.runtime.lastError);o()})})},async remove(t){return new Promise((e,o)=>{f.storage.local.remove(t,()=>{if(f.runtime.lastError)return o(f.runtime.lastError);e()})})}};/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */var C;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(C||(C={}));async function H(){try{const t=await b.get($);if(t==null)return null;const e=JSON.parse(t);return typeof e!="object"||e===null?(h.warn("Parsed settings data is not a valid object structure:",e),null):e}catch(t){return h.error("Failed to read/parse settings from storage:",t),null}}class P{id;devtools=null;inspector=null;devtoolsListener=null;inspectorListener=null;closed=!1;constructor(e){this.id=e,h.log(`Connection created for tab ${e}`)}setDevtools(e){this.removeDevtoolsListeners(),this.devtools=e,this.devtoolsListener=this.createDevtoolsListener(),this.devtoolsListener&&(this.devtools.onMessage.addListener(this.devtoolsListener),this.devtools.onDisconnect.addListener(()=>{h.log(`Background: Devtools disconnected for tab ${this.id}`),this.removeDevtoolsListeners(),this.devtools=null,this.inspector||this.close()})),this.checkCreatePipe()}setInspector(e){this.removeInspectorListeners(),this.inspector=e,this.inspectorListener=this.createInspectorListener(),this.inspectorListener&&(this.inspector.onMessage.addListener(this.inspectorListener),this.inspector.onDisconnect.addListener(()=>{h.log(`Background: Inspector disconnected for tab ${this.id}`),this.removeInspectorListeners(),this.inspector=null,this.devtools||this.close()})),this.checkCreatePipe()}checkCreatePipe(){this.devtools&&this.inspector&&this.devtoolsListener&&this.inspectorListener&&(h.log(`Background: Pipe established for tab ${this.id}`),M())}createDevtoolsListener(){return e=>{if(!(!this.inspector||this.closed)){if(!e.type||!e.payload){h.log("Background: Invalid message from devtools",e);return}if(e.type===y.HEARTBEAT){if(this.devtools)try{this.devtools.postMessage({source:m.BACKGROUND,type:y.HEARTBEAT_RESPONSE,payload:{}})}catch(o){h.log("Background: Error sending heartbeat response",o)}return}h.log(`devtools -> inspector: ${e.type}`,e.payload);try{this.inspector.postMessage({source:e.source,type:e.type,payload:e.payload})}catch(o){h.log("Background: Error forwarding message to inspector, port may be disconnected",o),this.removeInspectorListeners(),this.inspector=null,this.devtools||this.close()}}}}createInspectorListener(){return e=>{if(!(!this.devtools||this.closed)){if(!e.type||!e.payload){h.log("Background: Invalid message from inspector",e);return}h.log(`inspector -> devtools: ${e.type}`,e.payload);try{this.devtools.postMessage({source:e.source,type:e.type,payload:e.payload})}catch(o){h.log("Background: Error forwarding message to devtools, port may be disconnected",o),this.removeDevtoolsListeners(),this.devtools=null,this.inspector||this.close()}}}}removeDevtoolsListeners(){if(this.devtools&&this.devtoolsListener){try{this.devtools.onMessage.removeListener(this.devtoolsListener)}catch(e){h.log("Background: Error removing devtools listener",e)}this.devtoolsListener=null}}removeInspectorListeners(){if(this.inspector&&this.inspectorListener){try{this.inspector.onMessage.removeListener(this.inspectorListener)}catch(e){h.log("Background: Error removing inspector listener",e)}this.inspectorListener=null}}close(){this.closed||(this.closed=!0,h.log(`Background: Closing connection for tab ${this.id}`),this.removeDevtoolsListeners(),this.removeInspectorListeners(),this.devtools=null,this.inspector=null,p[this.id]=null,M())}isComplete(){return!!this.devtools&&!!this.inspector}isClosed(){return this.closed}getDevtools(){return this.devtools}getInspector(){return this.inspector}}const p={};function B(t){return+t+""===t}function G(t){f.scripting.executeScript({target:{tabId:t},files:["proxy.js"]},e=>{if(e)return;const o=t.toString(),l=p[o];if(l){const E=l.getInspector();E&&E.postMessage({source:m.BACKGROUND,type:y.PROXY_FAIL,payload:{}})}})}async function M(){const t=Object.keys(p).filter(e=>p[e]!==null&&!p[e]?.isClosed());await b.set(R,t)}async function K(){const e=await b.get(R)||[],l=(await f.tabs.query({})).map(g=>g.id?.toString()||"");e.filter(g=>l.includes(g)).forEach(g=>{p[g]||(p[g]=new P(g),B(g)&&G(+g))})}function V(){f.storage.onChanged.addListener(t=>{t.settings&&Object.keys(p).forEach(e=>{const o=p[e];if(o){const l=o.getDevtools();l&&l.postMessage({source:m.BACKGROUND,type:y.SETTINGS_CHANGED,payload:t})}})})}const X=Y(()=>{f.runtime.onInstalled.addListener(async t=>{["install","update"].includes(t.reason)&&await b.set(J,Date.now())}),V(),K(),f.runtime.onConnect.addListener(t=>{let e,o;B(t.name)?(e=t.name,o="devtools",G(+t.name)):(e=t.sender?.tab?.id?.toString()||"",o="inspector"),p[e]||(p[e]=new P(e)),o==="devtools"?p[e]?.setDevtools(t):p[e]?.setInspector(t)}),f.runtime.onMessage.addListener(async(t,e)=>{if(t.type===y.INJECT_INSPECTOR){const o=t.payload?.tabId||f.devtools?.inspectedWindow?.tabId;if(o)try{await f.scripting.executeScript({target:{tabId:o},files:["inspector.js"],world:"MAIN"}),h.log("Inspector script injected from background")}catch(l){h.error("Error injecting inspector script:",l)}return}if(e.tab?.id&&t.type===y.LOAD_DETECTOR)try{const o=await H(),l=o?.customAttributesToDetect&&Array.isArray(o.customAttributesToDetect)?o.customAttributesToDetect:[];await f.scripting.executeScript({target:{tabId:e.tab.id},world:"MAIN",func:(E,g)=>{window[E]=g},args:[U,l]}),await f.scripting.executeScript({target:{tabId:e.tab.id},files:["detector.js"],world:"MAIN"})}catch(o){h.error("Error loading detector:",o)}})});function Z(){}function A(t,...e){}const z={debug:(...t)=>A(console.debug,...t),log:(...t)=>A(console.log,...t),warn:(...t)=>A(console.warn,...t),error:(...t)=>A(console.error,...t)};let D;try{D=X.main(),D instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(t){throw z.error("The background crashed on startup!"),t}return D})();
